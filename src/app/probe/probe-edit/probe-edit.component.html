<form [formGroup]="probeForm" (ngSubmit)="onSubmit()">

  <h5>New Probe</h5>

  <div class="form-group offset-2 col-4">
    <label for="probeURL">Probe URL:</label>
    <div class="input-group" id="probeURL">

      <div class="input-group-prepend" >
        <select class="custom-select" formControlName="probePrefix">
            <option>http://</option>
            <option>https://</option>
        </select>
      </div>
      
      <input  type="url" class="form-control" placeholder="www.google.com" formControlName="probeURL" >
      <div class="inline-error" [hidden]="probeForm.controls.probeURL.valid || probeForm.controls.probeURL.pristine">
        Probe URI is required and must be a valid one.
      </div>

    </div>
  </div>

  <h6>Notification</h6>

  <div class="form-group offset-2 col-4">
    <label for="policy">Notification policy:<span tooltip="A notification policy sends a request to an external 
    service to notify a user or group of users that the event has occurred." style="font-size:80%"> Help?</span></label>
      <select id="policy" class="form-control col-12" formControlName="notification_policy_id" >
          <option value="">Do not Notify</option>
        <optgroup label="Notify using the policy:">
          <option *ngFor="let policy of policies" value="{{policy._id}}">{{policy.name}}</option>
        </optgroup>
      </select> 
  </div> 

  <h6>Monitoring Locations</h6>

  <div formGroupName = "locations">
    <div class="form-group offset-2 col-4">
      <div class="btn-group" >
          <label *ngFor="let location of locationsList; let i=index" [formControlName]="location.locationCode"
          btnCheckbox class="btn" 
          [ngClass]="probeForm.value.locations[location.locationCode] ? 'btn-primary' : 'btn-outline-secondary'"
          tabindex="{{i}}" role="button">{{location.label}}</label>
      </div>
      <div class="inline-error" [hidden]="probeForm.controls.locations.valid || probeForm.controls.locations.pristine" >
        Should be selected at least 2 locations.
      </div>
    </div>
  </div>

  <h6>General Settings</h6> 

  <div class="form-group offset-2 col-4">
      <label for="interval">Monitoring interval:</label>
      <div class="custom-slider" style="padding-bottom: 30px;">
        <ng5-slider id="interval" [(value)]="interval"  [options]="options" formControlName="interval"></ng5-slider>
      </div>
  </div>

  <div class="form-group offset-2 col-2">
      <label for="port">Port:</label>
      <input id="port" type="number" class="form-control" placeholder="80" formControlName="port">
      <div [hidden]="probeForm.controls.port.valid || probeForm.controls.port.pristine" class="inline-error">Port value is required</div>
  </div>

  <div class="form-group offset-2 col-2">
    <label for="method">Method:</label>
    <select id="method" class="form-control" formControlName="method"> 
      <option *ngFor="let method of methods">{{method}}</option>
    </select>
  </div> 
  
  <div class="form-group offset-2 col-4">
    <div class="form-check" [hidden]="probeForm.controls.method.value!='POST'">
        <input type="checkbox" id="request-body-json" class="form-check-input" value="" formControlName="requestBodyJson">
        <label for="request-body-json" class="form-check-label">POST body is JSON</label>
    </div>
  </div>
  
  <div class="form-group offset-2 col-4" [hidden]="probeForm.controls.method.value=='GET'">
    <label for="request-body">Request body:</label>
    <textarea id="request-body" class="form-control" rows="3" formControlName="requestBody"></textarea>
  </div>
  
  <div formArrayName="headers"> 

      <div class="form-group offset-2 col-8"> 
        <label >Headers:</label>
        
        <div class="form-row" *ngFor="let header of headers.controls; let i=index" [formGroupName]="i"> 
          <div class="form-group col">
            <select class="form-control" formControlName="key">
              <option *ngFor="let headerLabel of httpHeadersList" value="{{headerLabel}}">{{headerLabel}}</option>
            </select>
          </div>

          <div class="form-group col">
            <div class="input-group">
              <input type="text" class="form-control" formControlName="value" >
              <div class="input-group-append">
                <button class="btn btn-danger" type="button" (click)="removeHeader(i)" >-</button>
              </div>
            </div>
          </div>
        </div>
    </div>

    <div class="form-group offset-2 col-2">
        <button class="form-control" type="button" (click)="addHeader()">Add Header</button>
      </div>
  </div>

  <h6>Content Check</h6> 

  <div formGroupName = "matchPolicy">

    <div formArrayName="keywords"> 
      <label class="form-group offset-2 col-4">Keywords:</label>
      <div class="form-group offset-2 col-4" *ngFor="let keyword of keywords.controls; let i=index"> 
          <div class="input-group">
              <input type="text" class="form-control" [formControlName]="i" >
              <div class="input-group-append">
                  <button class="btn btn-danger" type="button" (click)="removeKeyword(i)" >-</button>
                </div>
          </div>
      </div>
      <div class="form-group offset-2 col-2">
        <button class="form-control" type="button" (click)="addKeyword()">Add Keyword</button>
      </div>
    </div>

    <div class="offset-2 col-4 form-group">
      <div class="form-check">
        <input id="match-all" class="form-check-input" type="checkbox" value="" formControlName="matchAll">
        <label class="form-check-label" for="match-all">Match all keywords</label>
      </div>
    </div>

  </div>
  
  <h6>Basic Authentication</h6> 
  
  <div formGroupName = "basicAuth">
    <div class="form-group offset-2 col-4">
        <label for="user">Username:</label>
        <input id="user" type="text" class="form-control" autocomplete="off" formControlName="user">
    </div>
    

    <div class="form-group offset-2 col-4">
        <label for="pass">Password:</label>
        <input id="pass"  type="password" class="form-control" autocomplete="new-password" formControlName="password">
    </div>
  </div>
  
  <div class="btn-group offset-2 col-4 top-buffer">
    <button type="submit" class="btn btn-primary mr-2" [disabled]="!probeForm.valid">Save</button>
    <button type="button" class="btn btn-outline-secondary" [routerLink]="['/probes']">Cancel</button>
  </div>

</form>