<form [formGroup]="probeForm" (ngSubmit)="onSubmit()">

  <h3>New Probe</h3>

  <div class="form-group offset-2 col-4">
    <label for="probeURL">Probe URL:{{probeForm.controls.probeURL.pristine}} {{probeForm.controls.probeURL.valid}}</label>
    <input id="probeURL" type="text" class="form-control" placeholder="http://www.google.com" formControlName="probeURL">
    <div class="alert alert-danger" [hidden]="probeForm.controls.probeURL.valid || probeForm.controls.probeURL.pristine">
      Probe URL is required
    </div>
  </div>

  <h5>Notification</h5>

  <div class="form-group offset-2 col-4">
    <label for="policy">Notification policy:</label>
    <select id="policy" class="form-control" formControlName="policy" >
      <option *ngFor="let policy of policies" value="{{policy._id}}">{{policy.name}}  </option>
    </select>
  </div>

  <h5>General Settings</h5> 

  <div class="form-group offset-2 col-4">
      <label for="interval">Monitoring interval:</label>
      <input id="interval" type="range" class="form-control-range" step="60" min="60" max="300" formControlName="interval" >
  </div>
  
  <div class="form-group offset-2 col-4">
    <label for="locations">Locations (select multiple):</label>
    <select  id="locations" multiple class="form-control" formControlName="locations">
      <option *ngFor="let location of locations_list" value="{{location}}" >{{location}}</option>
    </select>
  </div>
    
  <div class="form-group offset-2 col-2">
      <label for="port">Port:</label>
      <input id="port" type="number" class="form-control" placeholder="80" formControlName="port">
      <div [hidden]="probeForm.controls.port.valid || probeForm.controls.port.pristine" class="alert alert-danger"> Port value is required</div>
  </div>

  <div class="form-group offset-2 col-2">
    <label for="method">Method:</label>
    <select id="method" class="form-control" formControlName="method"> 
      <option *ngFor="let method of methods">{{method}}</option>
    </select>
  </div> 
  
  <div class="offset-2 col-4">
    <div class="form-check" [hidden]="probeForm.controls.method.value!='POST'">
        <input type="checkbox" id="post-body-json" class="form-check-input" value="" formControlName="postBodyJson">
        <label for="post-body-json" class="form-check-label">POST body is JSON</label>
    </div>
  </div>
  
  <div class="form-group offset-2 col-4" [hidden]="probeForm.controls.method.value=='GET'">
    <label for="post-body">Request body:</label>
    <textarea id="post-body" class="form-control" rows="3" formControlName="postBody"></textarea>
  </div>
  
  <div formArrayName="headers"> 

      <div class="form-group offset-2 col-8"> 
        <label >Headers:</label>
        
        <div class="form-row" *ngFor="let header of headers.controls; let i=index" [formGroupName]="i"> 
          <div class="form-group col">
            <select class="form-control" formControlName="key">
              <option selected>Accept</option>
              <option>Accept-Additions</option>
            </select>
          </div>

          <div class="form-group col">
            <div class="input-group">
              <input type="text" class="form-control" formControlName="value" >
              <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" (click)="removeHeader(i)" >-</button>
              </div>
            </div>
          </div>
        </div>

    </div>

    <div class="form-group offset-2 col-2">
        <button class="form-control" (click)="addHeader()">Add Header</button>
      </div>
  </div>

  <h5>Content Check</h5> 

  <div formArrayName="keywords"> 
    <label class="form-group offset-2 col-4">Keywords:</label>
    <div class="form-group offset-2 col-4" *ngFor="let keyword of keywords.controls; let i=index"> 
        <div class="input-group">
            <input type="text" class="form-control" [formControlName]="i" >
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" (click)="removeKeyword(i)" >-</button>
              </div>
        </div>
    </div>
    <div class="form-group offset-2 col-2">
      <button class="form-control" (click)="addKeyword()">Add Keyword</button>
    </div>
  </div>
  
  <div class="offset-2 col-4">
    <div class="form-check">
      <input id="exact-match" class="form-check-input" type="checkbox" value="" formControlName="exactMatch">
      <label class="form-check-label" for="exact-match">Match all</label>
    </div>
  </div>
  
  <h5>Basic Authentication</h5> 
  
  <div formGroupName = "basicAuth">
    <div class="form-group offset-2 col-4">
        <label for="user">Username:</label>
        <input id="user" type="text" class="form-control"  formControlName="user">
    </div>

    <div class="form-group offset-2 col-4">
        <label for="pass">Password:</label>
        <input id="pass"  type="password" class="form-control" formControlName="pass">
    </div>
  </div>
  {{ probeForm.status }}
  <div class="form-group offset-2 col-4">
    <button type="submit" class="btn btn-success" [disabled]="!probeForm.valid">Save</button>
  </div>

</form>